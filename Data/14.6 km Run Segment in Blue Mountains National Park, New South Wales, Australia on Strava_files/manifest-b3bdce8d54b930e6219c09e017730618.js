(function(){null==window.JST&&(window.JST={}),window.JST["segments/hazardous_waiver"]=function(t){return function(){var t,e,r;return e=window.HAML.escape,t=window.HAML.cleanValue,r=[],r.push("<div class='modal-header'>\n  <h3>"+e(t(Strava.I18n.Locale.t("templates.segments.hazardous_waiver.title",{name:this.name})))+"</h3>\n</div>\n<div class='modal-body'>"),this.waived||r.push("  <p>"+e(t(Strava.I18n.Locale.t("templates.segments.hazardous_waiver.info")))+"</p>"),r.push("  <div class='waiver-conditions'>"),r.push("    "+t(Strava.I18n.Locale.t("templates.segments.hazardous_waiver.waiver_html"))),r.push("  </div>\n</div>\n<div class='modal-footer'>"),this.waived||r.push("  <div class='text-center'>\n    <button class='btn btn-secondary mr-md waive'>"+e(t(Strava.I18n.Locale.t("templates.segments.hazardous_waiver.accept")))+"</button>\n    <button class='btn btn-default cancel'>"+e(t(Strava.I18n.Locale.t("templates.segments.hazardous_waiver.cancel")))+"</button>\n  </div>"),r.push("</div>"),r.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}).call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var a in r)e.call(r,a)&&(t[a]=r[a]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Segments"),Strava.Segments.HazardousWaiverView=function(e){function r(){this.template="segments/hazardous_waiver",this.lightbox=new Strava.Ui.LightboxView,r.__super__.constructor.call(this)}return t(r,e),r.prototype.events={"click .waive":"waiveSegment","click .cancel":"cancel"},r.prototype.render=function(t,e,r){return this.segmentId=t,this.setElement("<div></div>"),this.renderTemplate({name:e,waived:r}),this.lightbox.render(this.el),this.delegateEvents(),this},r.prototype.waiveSegment=function(){return jQuery.ajax({url:"/segments/"+this.segmentId+"/waive_segment_hazard",type:"PUT",success:function(){return window.location.reload()}})},r.prototype.cancel=function(){return this.lightbox.closeBox()},r.createInstance=function(){return this.instance=new Strava.Segments.HazardousWaiverView},r.show=function(t,e,r){return this.instance.render(t,e,r)},r}(Backbone.View)}.call(this),function(){Strava.module("Strava.Segments"),Strava.Segments.Initializer=function(){function t(t){var e,r,n;this.params=t,r=function(t){return function(e){var r;return jQuery(".chart").addClass("background-off"),e={distance:t.context.context.get("distance"),altitude:t.context.context.get("altitude"),isConverted:!1},r=new Strava.Directory.ElevationDataContext(e,null,t.context.eventDispatcher),new Strava.Directory.ElevationChart(r).render()}}(this),this.startLatLng=null,this.endLatLng=null,e=jQuery("#map_canvas"),this.context=Strava.Segments.StreamContextRegistry.contextFor(this.params.segmentId),this.context.request.require(["latlng","distance","altitude"],{onReady:function(t){return r(t)}}),Strava.Maps.buildSegmentMap(this.params.segmentId,e),new Strava.Segments.SegmentStreetView(this.context.eventDispatcher,jQuery("#street-view"),this.params.showStreetView,this.params.openInWindow),this.params.canStarSegment&&new Strava.Segments.StarredSegmentViewCollection("segment-detail").addSegmentEfforts(".segment-name .starred"),n=jQuery("#segment-leaderboard").find("ul.filters .selected").data("filter-hide"),n&&jQuery("#"+n).hide(),this.params.segmentHazard&&(Strava.Segments.HazardousWaiverView.createInstance(),jQuery("#system-messages-js").on("click","#hazard-waiver",function(t){return function(){return Strava.Segments.HazardousWaiverView.show(t.params.segmentId,t.params.segmentName,t.params.segmentHazardWaived)}}(this)),this.params.segmentHazardWaived&&this.params.showWaiver&&Strava.Segments.HazardousWaiverView.show(this.params.segmentId,this.params.segmentName,this.params.segmentHazardWaived))}return t.prototype.setUpStreetView=function(){return jQuery("#show_start_street_view").on("click",function(){}),jQuery("#show_end_street_view").on("click",function(){})},t}(),Strava.Segments.SegmentStreetView=function(){function t(t,e,r,n){this.eventDispatcher=t,this.$canvas=e,this.showStreetView=r,this.openInWindow=n,this.eventDispatcher.addListener(this,this)}return t.prototype.handleStreamMouseOver=function(){},t.prototype.handleStreamMouseOut=function(){},t.prototype.handleStreamClick=function(){},t.prototype.handleStreamDoubleClick=function(){},t.prototype.handleStreamSelect=function(){},t.prototype.handleStreamUnselect=function(){},t.prototype.handleStreamHover=function(){},t.prototype.handleStreamHoverOut=function(){},t.prototype.handleChangeXAxisType=function(){},t.prototype.handleMarkerClick=function(t,e,r){var n,a,i,s;if(this.showStreetView)return a=e+","+r,t="k",n="c",i=a,s="http://maps.google.com/maps?q="+a+"&t="+t+"&layer="+n+"&cbll="+i,window.open(s,"streetview")},t}()}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var a in r)e.call(r,a)&&(t[a]=r[a]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Segments"),Strava.Segments.Leaderboard=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.url=function(){var t;return t="/segments/"+this.get("segmentId")+"/leaderboard?raw=true"},r}(Backbone.Model)}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var a in r)e.call(r,a)&&(t[a]=r[a]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Segments"),Strava.Segments.StarredSegment=function(e){function r(t){r.__super__.constructor.call(this,_.extend(t,{id:t.segment_id}))}return t(r,e),r.prototype.url=function(){return"/segments/"+this.get("segment_id")+"/starred?source="+this.get("source")},r.prototype.toggleStar=function(){var t;return t="on"===this.get("active")?"off":"on",this.set("active",t),this.save()},r}(Backbone.Model)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["segments/starred"]=function(t){return function(){var t;return t=[],t.push("<span class='app-icon-wrapper'>\n  <span class='app-icon icon-dark icon-lg icon-star'>&#9733;</span>\n</span>"),t.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var a in r)e.call(r,a)&&(t[a]=r[a]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Segments"),Strava.Segments.StarredSegmentView=function(e){function r(t,e){null==e&&(e={}),r.__super__.constructor.call(this,e),this.starredSegment=t,this.starredSegment.bind("change",this.render,this),this.template="segments/starred","on"===this.starredSegment.get("active")?this.$el.attr("title",Strava.I18n.Locale.t("strava.segments.starred_segment_view.unstar")):this.$el.attr("title",Strava.I18n.Locale.t("strava.segments.starred_segment_view.star"))}return t(r,e),r.prototype.className="starred",r.prototype.events={click:"handleStarClick"},r.prototype.render=function(){return this.render_template(this.starredSegment.toJSON()),"on"===this.starredSegment.get("active")?(this.$el.addClass("active"),this.$el.attr("title",Strava.I18n.Locale.t("strava.segments.starred_segment_view.unstar"))):(this.$el.removeClass("active"),this.$el.attr("title",Strava.I18n.Locale.t("strava.segments.starred_segment_view.star"))),this},r.prototype.handleStarClick=function(){return this.starredSegment.toggleStar(),!1},r}(Backbone.View)}.call(this),function(){Strava.module("Strava.Segments"),Strava.Segments.StarredSegmentViewCollection=function(){function t(t){this.starredSegments={},this.starredSegmentViews=[],this.source=t}return t.prototype.addSegmentEffort=function(t,e,r){var n,a;return this.starredSegments[t]?n=this.starredSegments[t]:(n=new Strava.Segments.StarredSegment({segment_id:t,active:e,source:this.source}),this.starredSegments[t]=n),a=new Strava.Segments.StarredSegmentView(n,{el:r}),this.starredSegmentViews.push(a),a},t.prototype.addSegmentEfforts=function(t){return jQuery(t).each(function(t){return function(e,r){var n,a,i;return i=jQuery(r),a=i.data("segment-id"),n=i.hasClass("active")?"on":"off",t.addSegmentEffort(a,n,i)}}(this))},t}()}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var a in r)e.call(r,a)&&(t[a]=r[a]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Segments"),Strava.Segments.StarredSegmentsListView=function(e){function r(t,e){r.__super__.constructor.call(this,e),this.athlete=t,this.goalsController=new Strava.PerformanceGoals.Controller({current_athlete_id:this.athlete.get("id")}),this.goalsController.bind("goalCreated",function(t){return window.location="/goals/segment/"+t.get("id")})}return t(r,e),r.prototype.events={"click .set-goal":"handleSetGoalClick"},r.prototype.handleSetGoalClick=function(t){var e,r;return this.athlete.get("premium")?(r=jQuery(t.target),e=new Strava.PerformanceGoals.SegmentGoal({goal_detail:{segment_id:r.data("segment-id"),segment_name:r.data("segment-name")}}),Strava.PerformanceGoals.Create.View.show(e,this.goalsController)):new Strava.Ui.TooltipView("performance_goals/tooltip").render({},t.currentTarget)},r}(Backbone.View)}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var a in r)e.call(r,a)&&(t[a]=r[a]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.Segments.StarredTooltip=function(e){function r(t){r.__super__.constructor.call(this,t)}return t(r,e),r.createInstance=function(t){return Strava.Ui.TooltipView.createInstance(t,this)},r.show=function(t,e){return Strava.Ui.TooltipView.show(t,e)},r}(Strava.Ui.TooltipView)}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var a in r)e.call(r,a)&&(t[a]=r[a]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava"),Strava.base_module={initializeAttributes:function(t){var e,r,n;r=[];for(e in t)n=t[e],r.push(this.initAttribute(e,n));return r},setOrGet:function(t,e){return void 0!==e?(this[t]=e,this):this[t]},initAttribute:function(t,e){var r;return this.constructor.prototype[t]=function(t){return this.setOrGet(r,t)},r="_"+t,this[r]=!_.isObject(e)||_.isFunction(e)||e.constructor!==Object.prototype.constructor&&e.constructor!==Array.prototype.constructor?e:_.clone(e)},create_template:function(t){var e;return e=jQuery(t),this.template=_.template(e.html())},create_template_for:function(t){var e;return e=jQuery(t),_.template(e.html())}},Strava.chart_module={shouldAnimate:function(t){return null!=this.animate()?this.animate():t}},Strava.local_storage_module={initializeStorageAttributes:function(t,e,r){var n,a,i;null==r&&(r=!1),r&&this.setLocalStorage(e,{}),a=[];for(n in t)i=t[n],a.push(this.initStorageAttribute(n,i,e));return a},getLocalStorage:function(t){var e;return e=localStorage[t],e?JSON.parse(localStorage[t])||{}:{}},setLocalStorage:function(t,e){return localStorage[t]=JSON.stringify(e)},setOrGetStorage:function(t,e,r){var n;return n=this.getLocalStorage(r),void 0!==e?(n[t]=e,this.setLocalStorage(r,n),this):n[t]},initStorageAttribute:function(t,e,r){var n,a;if(this.constructor.prototype[t]=function(t){return this.setOrGetStorage(n,t,r)},n="_"+t,!_.isObject(e)||_.isFunction(e)||e.constructor!==Object.prototype.constructor&&e.constructor!==Array.prototype.constructor)return a=this.setOrGetStorage(n,void 0,r),void 0!==a&&(e=a),this.setOrGetStorage(n,e,r);throw new Error("cannot store non-primitive types in localstorage")}},Strava.Base=function(){function t(){}return Strava.includeModule(t,Backbone.Events),Strava.includeModule(t,Strava.base_module),t.prototype.$=function(t,e){return e.find(t)},t.prototype.$$=function(t){return jQuery(t)},t.prototype.$document=function(){return jQuery(document)},t.prototype.one=function(t,e,r){var n,a,i,s;return s=this,n=e,a=t,i=function(){return n.call(this),s.unbind(a,i)},this.bind(t,i,r)},t.prototype.createHandler=function(t){return function(){var e;return e=Array.prototype.slice.call(arguments),e.unshift(this),t.apply(null,e)}},t.prototype.isTouchDevice=function(){return Modernizr?Modernizr.touch:!1},t}(),Strava.Controller=function(e){function r(){r.__super__.constructor.call(this)}return t(r,e),Strava.includeModule(r,Strava.base_module),r.prototype.parse=function(){return{id:0}},r}(Backbone.Model)}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var a in r)e.call(r,a)&&(t[a]=r[a]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.EventDispatcher=function(e){function r(){r.__super__.constructor.call(this),this.mouseIndexes={},this.hoverExtent=null,this.selection=null}return t(r,e),r.prototype.addListener=function(t,e){return this.bind("mouseOver",function(r,n,a){return t!==r?e.handleStreamMouseOver(n,a):void 0}),this.bind("slide",function(r,n,a){return t!==r&&null!=e.handleStreamSlide?e.handleStreamSlide(n,a):void 0}),this.bind("slideReset",function(r,n,a){return t!==r&&null!=e.handleStreamSlideReset?e.handleStreamSlideReset(n,a):void 0}),this.bind("mouseOut",function(r,n){return t!==r&&null!=e.handleStreamMouseOut?e.handleStreamMouseOut(n):void 0}),this.bind("click",function(r,n,a){return t!==r?e.handleStreamClick(n,a):void 0}),this.bind("doubleClick",function(r,n,a){return t!==r?e.handleStreamDoubleClick(n,a):void 0}),this.bind("hover",function(r,n,a,i){return t!==r&&null!=e.handleStreamHover?e.handleStreamHover(n,a,i):void 0}),this.bind("hoverOut",function(r,n,a,i){return t!==r&&null!=e.handleStreamHoverOut?e.handleStreamHoverOut(n,a,i):void 0}),this.bind("select",function(r,n,a,i){return t!==r?e.handleStreamSelect(n,a,i):void 0}),this.bind("unselect",function(r,n,a,i){return t!==r?e.handleStreamUnselect(n,a,i):void 0}),this.bind("zoomSelect",function(r,n,a,i,s){return t!==r&&null!=e.handleZoomSelect?e.handleZoomSelect(n,a,i,s):void 0}),this.bind("zoomUnselect",function(r,n,a,i){return t!==r&&null!=e.handleZoomUnselect?e.handleZoomUnselect(n,a,i):void 0}),this.bind("indexedZoom",function(r,n,a,i){return t!==r&&null!=e.handleIndexedZoom?e.handleIndexedZoom(n,a,i):void 0}),this.bind("initiateZoom",function(r,n,a,i){return t!==r&&null!=e.handleInitiateZoom?e.handleInitiateZoom(n,a,i):void 0}),this.bind("zoomChange",function(r,n){return t!==r&&null!=e.handleZoomChange?e.handleZoomChange(r,n):void 0}),this.bind("changeXAxisType",function(r,n){return t!==r&&null!=e.handleChangeXAxisType?e.handleChangeXAxisType(n):void 0}),this.bind("markerClick",function(r,n,a,i){return t!==r&&null!=e.handleMarkerClick?e.handleMarkerClick(n,a,i):void 0})},r.prototype.dispatchMouseOver=function(t,e,r){return this.mouseIndexes[e]!==r?(this.mouseIndexes[e]=r,this.trigger("mouseOver",t,e,r)):void 0},r.prototype.dispatchSlide=function(t,e,r){return this.trigger("slide",t,e,r)},r.prototype.dispatchSlideReset=function(t,e,r){return this.trigger("slideReset",t,e,r)},r.prototype.dispatchClick=function(t,e,r){return this.trigger("click",t,e,r)},r.prototype.dispatchDoubleClick=function(t,e,r){return this.trigger("doubleClick",t,e,r)},r.prototype.dispatchHover=function(t,e,r,n){return this.hoverExtent=[r,n],null==this.selection?this.trigger("hover",t,e,r,n):void 0},r.prototype.dispatchUnconditionalHover=function(t,e,r,n){return this.hoverExtent=[r,n],this.trigger("hover",t,e,r,n)},r.prototype.dispatchHoverOut=function(t,e,r,n){return this.hoverExtent=null,null==this.selection?this.trigger("hoverOut",t,e,r,n):void 0},r.prototype.dispatchSelect=function(t,e,r,n){return this.selection=[r,n],this.trigger("select",t,e,r,n)},r.prototype.dispatchUnselect=function(t,e,r,n){var a,i,s;return this.selection=null,this.trigger("unselect",t,e,r,n),this.hoverExtent?(s=this.hoverExtent,i=s[0],a=s[1],this.trigger("hover",t,e,i,a)):void 0},r.prototype.dispatchZoomSelect=function(t,e,r,n,a){return this.trigger("zoomSelect",t,e,r,n,a)},r.prototype.dispatchZoomUnselect=function(t,e,r,n){return this.trigger("zoomUnselect",t,e,r,n)},r.prototype.dispatchMouseOut=function(t,e){return-1===this.mouseIndexes[e],this.trigger("mouseOut",t,e)},r.prototype.dispatchIndexedZoom=function(t,e,r,n){return this.trigger("indexedZoom",t,e,r,n)},r.prototype.dispatchInitiateZoom=function(t,e,r,n){return this.trigger("initiateZoom",t,e,r,n)},r.prototype.dispatchZoomChange=function(t,e){return this.trigger("zoomChange",t,e)},r.prototype.dispatchChangeXAxisType=function(t,e){return this.trigger("changeXAxisType",t,e)},r.prototype.dispatchMarkerClick=function(t,e,r,n){return this.trigger("markerClick",t,e,r,n)},r.prototype.reset=function(){return this.off(),this.selection=null,this.hoverExtent=null},r}(Strava.Base),Strava.Labs.Activities.listener_module={handleStreamMouseOver:function(){},handleStreamSlide:function(){},handleStreamSlideReset:function(){},handleStreamMouseOut:function(){},handleStreamClick:function(){},handleStreamDoubleClick:function(){},handleStreamSelect:function(){},handleStreamUnselect:function(){},handleStreamHover:function(){},handleStreamHoverOut:function(){},handleChangeXAxisType:function(){},handleMarkerClick:function(){}}}.call(this),function(){window.strava||(window.strava={}),window.strava.Math||(window.strava.Math={smoothIndices:function(t,e,r,n){for(var a=[],i=0;i<t.length;i++){for(var s=i,o=i,c=0,u=!0;(n?2:1)>c&&(r>o-s+1||t[o]-t[s]<e);){var l=!1;u&&s>0&&(s--,l=!0),!u&&o<t.length-1&&(o++,l=!0),c=l?0:c+1,u=!n||!u}a.push([s,o])}return a},calculateSpeed:function(t,e,r,n,a,i){for(var s=strava.Math.smoothIndices(r?t:e,n,a,r),o=[],c=0,u=0;u<s.length;u++){var l=s[u][0],d=s[u][1],h=e[d]-e[l],p=0;if(h>0){var v=t[d]-t[l];if(p=v/h,u>0){var m=(p-o[c])/(e[u]-e[c]);m>i&&(p=null)}}o.push(null!=p?p:o[c]),null!=p&&(c=u)}return o},yMin:function(t){var e=Math.min.apply(null,t),r=Math.max.apply(null,t),n=r-e,a=Math.floor(Math.log(n)/Math.log(10));a-=1,0>a&&(a=0);var i=Math.pow(10,a),s=Math.floor(e/i)*i;return s-=i},yMax:function(t){return Math.max.apply(null,t)},intervalLength:function(t,e){var r=t/e,n=Math.floor(Math.log(r)/Math.log(10)),a=Math.pow(10,n);return a*Math.ceil(r/a)},isClosest:function(t,e,r){if(r>=t.length-1)return!0;var n=t[r],a=t[r+1];return Math.abs(n-e)<Math.abs(a-e)},closestIndex:function(t,e,r){for(r||(r=0);!strava.Math.isClosest(t,e,r);)r++;return r},range:function(t){return t[t.length-1]-t[0]},patchDataSet:function(t){for(var e=0,r=0,n=0;n<t.length;n++){var a=t[n];if(a){var i=e-(a+r);i>0&&(r+=i),r>0&&(t[n]=a+r),e=t[n]}else t[n]=e}return t},getIntervalIndices:function(t,e){var r=[];if(t.length<=e){for(var n=0;n<t.length;n++)r.push(n);for(n=t.length-1;n>=0;n--)t[n-1]==t[n]&&r.splice(n-1,1)}else{var a=strava.Math.range(t),i=a/(e-1);r=strava.Math.getIndicesAt(t,i)}return r},getIndicesAt:function(t,e,r){var n=[],a=t[0];r&&(a+=e);for(var i=0;i<t.length-1;)for(i=strava.Math.closestIndex(t,a,i),n.push(i);i<t.length-1&&strava.Math.isClosest(t,a,i);)a+=e;return n},rabbitData:function(t,e){for(var r=strava.Math.range(e.time)-strava.Math.range(t.time),n=strava.Math.range(t.distance)/strava.Math.range(e.distance),a={indices:[],timeBehind:[]},i=0,s=0,o=0,c=0;c<t.time.length;c++){var u=t.time[c]-t.time[0]+e.time[0];if(u>e.time[e.time.length-1])i=t.time.length-1,o=r;else{s=strava.Math.closestIndex(e.time,u,s);var l=t.distance[0]+(e.distance[s]-e.distance[0])*n;i=strava.Math.closestIndex(t.distance,l,i),o=t.time[c]-t.time[i]}a.indices.push(i),a.timeBehind.push(o)}return a},closestPoint:function(t,e){var r=t.data;if(r.length<=1||e<=r[0].x)return r[0];for(var n=null,a=0;a<r.length;a++){var i=Math.abs(r[a].x-e);if(null!=n&&i>=n)return r[a-1];n=i}return r[r.length-1]},getSeriesIndices:function(t,e){for(var r=[],n=strava.Math.range(t),a=e;n>a;){var i=r.length>0?r[r.length-1]:0;r.push(strava.Math.closestIndex(t,a,i)),a+=e}return r}})}(jQuery),function(t){window.strava||(window.strava={}),window.strava.globalDispatch||(window.strava.globalDispatch=_.extend({},Backbone.Events)),window.strava.asset||(window.strava.asset={host:function(){return window._asset_host},image:function(t){return strava.asset.url("/images/"+t)},url:function(t){return strava.asset.host()+t},sprite:function(){return"/assets/sprites/sprites-map-2952f0a9e3b82350c97acb7fa5333d10.png"}}),window.strava.forms||(window.strava.forms={Slider:function(e,r){r=t.extend({start:0,end:100,step:1,start_input:"#"+e+"_start",end_input:"#"+e+"_end",label:"."+e,div:"#"+e,plus:!1,time:!1,hours:!0,minutes:!0,seconds:!0,round:!0},r),this.perform_slide=function(e,n){t(r.start_input).val(e),t(r.end_input).val(n);var a=e,i=n;r.time?(a=(new Strava.I18n.TimespanFormatter).display(60*e*60),i=(new Strava.I18n.TimespanFormatter).display(60*n*60)):(a=(new TwitterCldr.DecimalFormatter).format(e),i=(new TwitterCldr.DecimalFormatter).format(n)),t(r.label).html(r.plus&&n==r.end?a+" - "+i+"+":a+" - "+i)},this.start=t(r.start_input).val(),this.end=t(r.end_input).val(),this.start=r.round?parseInt(this.start):parseFloat(this.start),this.end=r.round?parseInt(this.end):parseFloat(this.end);var n=this;this.actual_slider=t(r.div).slider({range:!0,min:r.start,max:r.end,step:r.step,values:[this.start,this.end],slide:function(t,e){n.perform_slide(e.values[0],e.values[1])}}),this.reset=function(){return n.actual_slider?(n.actual_slider.slider("values",0,r.start),void n.actual_slider.slider("values",1,r.end)):!1},this.perform_slide(this.start,this.end)}}),window.strava.sliders||(window.strava.sliders={Slider:function(e,r){r=t.extend({start_icon:"select-start",end_icon:"select-end",start_color:"#54B03A",end_color:"#F00",color:"#105CB6",start:null,end:null,highlight:null,selector:"#slider-range",step:1,slide:null},r);var n=this;this.object=t(r.selector),this.route=e,this.map=e.map,this.start=r.start,this.end=r.end,this.min=0,this.max=n.route.polyline.getLength()-1,this.start="first"==r.start?this.min:this.start?parseInt(this.start):this.min,this.end="last"==r.end?this.max:this.end?parseInt(this.end):Math.floor(e.polyline.getLength()/2),this.start_icon=new strava.maps.Icon(r.start_icon,e.polyline.getAt(this.start),this.map),this.end_icon=new strava.maps.Icon(r.end_icon,e.polyline.getAt(this.end),this.map),this.route.setHighlight(this.start,this.end),this.object.append("<div class='actual-slider'/>"),this.object.append("<div id='start-control'/>"),this.object.find("#start-control").append("<div class='label'>"+Strava.I18n.Locale.t("strava.ui.slider.move_start")+"</div>"),this.object.find("#start-control").append("<button id='move-start-back' class='minimal compact'>"+Strava.I18n.Locale.t("strava.ui.slider.back")+"</button>"),this.object.find("#start-control").append("<button id='move-start-forward' class='minimal compact'>"+Strava.I18n.Locale.t("strava.ui.slider.forward")+"</button>"),this.object.append("<div id='end-control'/>"),this.object.find("#end-control").append("<div class='label'>"+Strava.I18n.Locale.t("strava.ui.slider.move_end")+"</div>"),this.object.find("#end-control").append("<button id='move-end-back' class='minimal compact'>"+Strava.I18n.Locale.t("strava.ui.slider.back")+"</button>"),this.object.find("#end-control").append("<button id='move-end-forward' class='minimal compact'>"+Strava.I18n.Locale.t("strava.ui.slider.forward")+"</button>"),this.actual_slider=this.object.find(".actual-slider"),this.performSlide=function(e,a){e>a&&a==n.end&&(e=n.start),e<n.min&&(e=n.min),a>n.max&&(a=n.max),e>a&&(a=n.end),n.start!=e&&(n.start=e,n.start_icon.move(n.route.polyline.getAt(n.start)),n.start_icon.visible()||n.start_icon.center()),n.end!=a&&(n.end=a,n.end_icon.move(n.route.polyline.getAt(n.end)),n.end_icon.visible()||n.end_icon.center()),n.route.setHighlight(n.start,n.end),t.isFunction(r.slide)&&r.slide(n.start,n.end,n.start_icon,n.end_icon)},this.getStep=function(){var t=n.map.google.getZoom();return t>=17?1:t>=15?2:t>=13?5:t>=10?10:20},this.object.find("#move-start-forward").on("click",function(){n.actual_slider.slider("values",0,n.start+n.getStep()),n.performSlide(n.actual_slider.slider("values",0),n.end)}),this.object.find("#move-start-back").on("click",function(){n.actual_slider.slider("values",0,n.start-n.getStep()),n.performSlide(n.actual_slider.slider("values",0),n.end)}),this.object.find("#move-end-forward").on("click",function(){n.actual_slider.slider("values",1,n.end+n.getStep()),n.performSlide(n.start,n.actual_slider.slider("values",1))}),this.object.find("#move-end-back").on("click",function(){n.actual_slider.slider("values",1,n.end-n.getStep()),n.performSlide(n.start,n.actual_slider.slider("values",1))}),this.actual_slider.slider({range:!0,min:n.min,max:n.max,values:[n.start,n.end],step:r.step,slide:function(t,e){n.performSlide(e.values[0],e.values[1])}}),t(".ui-slider-handle:first").css("background",r.start_color),t(".ui-slider-handle:last").css("background",r.end_color),t(".ui-slider-range").css("background",r.color),this.performSlide(this.start,this.end)}}),window.strava.shareDialogs||(window.strava.shareDialogs={dialogs:{email:t("#email-share-activity-dialog").dialog({autoOpen:!1,resizable:!1,draggable:!1,modal:!0,height:390,width:440,title:"Email",open:Strava.Util.Dialog.setupModalCloseClick}),embed:t("#embed-share-activity-dialog").dialog({autoOpen:!1,resizable:!1,draggable:!1,modal:!0,width:470,title:"Embed a Widget on your Blog",open:Strava.Util.Dialog.setupModalCloseClick})},openShareDialog:function(t){for(var e in strava.shareDialogs.dialogs)e!=t&&strava.shareDialogs.dialogs[e].dialog("close");strava.shareDialogs.dialogs[t].dialog("open")},openFacebook:function(t){var e={method:"feed",name:t.name,link:t.link,picture:t.picture,description:t.message,actions:[{name:t.action,link:t.link}]};FB.ui(e)},openTwitter:function(t){this.inProgressMessage=t.inProgressMessage,this.menuSelector=t.menuSelector;var e=this.dialogs.twitter.find("form");e.find("input[name='id']").attr("value",t.id),e.find("input[name='menu_selector']").attr("value",this.menuSelector),e.find("textarea[name='message']").attr("value",t.message),this.dialogs.twitter.dialog("option","title",t.title),this.openShareDialog("twitter")},openEmail:function(t){this.inProgressMessage=t.inProgressMessage,this.menuSelector=t.menuSelector;var e=this.dialogs.email.find("form");e.find("input[name='activity_id']").attr("value",t.id),e.find("input[name='menu_selector']").attr("value",this.menuSelector),this.dialogs.email.dialog("option","title",t.title),this.openShareDialog("email")},openEmbed:function(t){var e=this.dialogs.embed.find("form");e.find("#embed-label").text(t.label),e.find("textarea").text("<iframe height='405' width='590' frameborder='0' allowtransparency='true' scrolling='no' src='"+t.url+"'></iframe>"),this.dialogs.embed.dialog("option","title",t.title),this.openShareDialog("embed")},menuSelector:"",inProgressMessage:"",initialized:!1,initialize:function(){t("form#share-by-email").submitWithAjax(function(){return strava.shareDialogs.dialogs.email.dialog("close"),jQuery(strava.shareDialogs.menuSelector+" .menu-title").hide(),jQuery(strava.shareDialogs.menuSelector+" .status").html(strava.shareDialogs.inProgressMessage).show(),!0}),t("ul.options, ul.share").on("click","a.facebook-dialog",function(){return t.get(t(this).attr("href"),null,function(t){strava.shareDialogs.openFacebook(t)}),!1}),t("ul.options, ul.share").on("click","a.twitter-dialog",function(){return!0}),t("ul.options, ul.share").on("click","a.embed-dialog",function(){return t.get(t(this).attr("href"),null,function(t){strava.shareDialogs.openEmbed(t)}),!1}),t("ul.options, ul.share").on("click","a.email-dialog",function(){return t.get(t(this).attr("href"),null,function(t){strava.shareDialogs.openEmail(t)}),!1})}}),t.fn.ajaxAnchorLink=function(e){e=t.extend({loadingMsg:"Loading...",beforeLinkHandler:null,afterLinkHandler:null,emptyLinkHandler:null,container:"#secondary-nav"},e),t(window).hashchange(function(){var r=location.hash.replace(/^#/,"");if(r.length>0){var n=t(this).parents(".ajax-loading-container");0==n.length&&(n=t(e.container));var a=n.find(".ajax-loading-status span");t.isFunction(e.beforeLinkHandler)&&e.beforeLinkHandler(this),e.loadingMsg&&(a.html(e.loadingMsg),a.show()),t.getScript(window.location.pathname+"/"+r,function(){t.isFunction(e.afterLinkHandler)&&e.afterLinkHandler(this),a.hide()})}else t.isFunction(e.emptyLinkHandler)&&e.emptyLinkHandler(this)}),t(window).hashchange()},t.fn.clientSideAnchorLink=function(e){e=t.extend({linkHandler:null,emptyLinkHandler:null},e),t(window).hashchange(function(){var r=location.hash.replace(/^#/,"");r.length>0?t.isFunction(e.linkHandler)&&e.linkHandler(r):t.isFunction(e.emptyLinkHandler)&&e.emptyLinkHandler()}),t(window).hashchange()}}(jQuery),function(){var t=function(t,r){function n(){this.constructor=t}for(var a in r)e.call(r,a)&&(t[a]=r[a]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.I18n"),Strava.I18n.ChartLabelElevationFormatter=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.convert=function(t){return t},r}(Strava.I18n.ElevationFormatter)}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var a in r)e.call(r,a)&&(t[a]=r[a]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.I18n"),Strava.I18n.ChartLabelPaceFormatter=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.convert=function(t){return t},r}(Strava.I18n.PaceFormatter)}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var a in r)e.call(r,a)&&(t[a]=r[a]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.I18n"),Strava.I18n.DoubledStepCadenceFormatter=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.convert=function(t){return 2*t},r}(Strava.I18n.StepCadenceFormatter)}.call(this),function(){Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.StreamSplit=function(){function t(t,e,r){this.streamData=t,this.start=e,this.end=r,this.paceFormatter=new Strava.I18n.ChartLabelPaceFormatter,this.elevationFormatter=new Strava.I18n.ChartLabelElevationFormatter,this.heartRateFormatter=new Strava.I18n.HeartRateFormatter,this.cadenceFormatter=new Strava.I18n.DoubledStepCadenceFormatter}return t.prototype.indices=function(){return[this.start,this.end]},t.prototype.setLabel=function(t){return this.label=t},t.prototype.pace=function(){var t,e;return e=this.streamData.get("time"),t=this.distance(),null!=t?(e[this.end]-e[this.start])/t:void 0},t.prototype.formattedPace=function(t){return null==t&&(t=!0),t?this.paceFormatter.abbreviated(this.pace()):this.paceFormatter.format(this.pace())},t.prototype.formattedGAP=function(){return this.paceFormatter.abbreviated(this.gap())},t.prototype.distance=function(){var t;return t=this.streamData.get("distance"),null!=t?t[this.end]-t[this.start]:void 0},t.prototype.gap=function(){var t,e;return this.streamData.has("grade_adjusted_distance")?(t=this.streamData.get("grade_adjusted_distance"),e=this.streamData.get("time"),(e[this.end]-e[this.start])/(t[this.end]-t[this.start])):null},t.prototype.heartrate=function(){var t;return this.streamData.has("heartrate")?(t=this.streamData.get("heartrate"),d3.round(d3.mean(t.slice(this.start,+this.end+1||9e9)))):null},t.prototype.formattedHeartrate=function(){var t;return t=this.heartrate(),t?this.heartRateFormatter.abbreviated(t):null},t.prototype.cadence=function(){var t;return this.streamData.has("cadence")?(t=this.streamData.get("cadence"),d3.round(d3.mean(t.slice(this.start,+this.end+1||9e9)),0)):null},t.prototype.formattedCadence=function(){var t;return t=this.cadence(),t?this.cadenceFormatter.abbreviated(t):null},t.prototype.elevation=function(){var t;return this.streamData.has("altitude")?(t=this.streamData.get("altitude"),t[this.end]-t[this.start]):null},t.prototype.elapsedTime=function(){var t;return t=this.streamData.get("time"),t[this.end]-t[this.start]},t.prototype.spans=function(t,e){return t===this.start&&e===this.end},t.prototype.summarize=function(){var t;return t=null!=this.elevation()?this.elevationFormatter.abbreviated(this.elevation()):void 0,{pace:this.formattedPace(),distance:this.distance(),heartrate:this.formattedHeartrate(),cadence:this.formattedCadence(),gap:this.formattedGAP(),elevation:t,label:this.label,start:this.start,end:this.end}},t}()}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var a in r)e.call(r,a)&&(t[a]=r[a]);
return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.StreamData=function(e){function r(t,e){null==t&&(t={}),null==e&&(e={}),r.__super__.constructor.call(this),this.initializeAttributes(n),this.data=t,this.derivedData={},this.conversionsToMeters(e)}var n;return t(r,e),n={conversionsToMeters:{}},r.prototype.conversionToMeters=function(t){return this.conversionsToMeters()[t]||1},r.prototype.all=function(){return this.data},r.prototype.get=function(t){return this.data[t]},r.prototype.getInMeters=function(t){var e,r,n;return r=this.data[t],e=this.conversionToMeters(t),null!=e&&1!==e&&(r=function(){var t,a,i;for(i=[],t=0,a=r.length;a>t;t++)n=r[t],i.push(n*e);return i}()),r},r.prototype.has=function(t){return null!=this.data[t]},r.prototype.types=function(){return Object.keys(this.data)},r.prototype.add=function(t,e){return this.data[t]=e},r.prototype.extend=function(t,e){return this.data[t]?this.data[t]=this.data[t].concat(e):this.add(t,e)},r.prototype.length=function(){var t;return this.has("time")?this.get("time").length:this.has("distance")?this.get("distance").length:(t=types&&types[0])?this.get(t).length:void 0},r.prototype.getAveragePace=function(){return this.fullSplit().pace()},r.prototype.getAverageGap=function(){return this.fullSplit().gap()},r.prototype.getIntervalMax=function(t,e,r){return this.data[t]?d3.max(this.data[t].slice(e,+r+1||9e9)):null},r.prototype.getIntervalAverage=function(t,e,r){var n,a,i,s,o,c,u,l,d,h,p,v,m;if(!this.data[t]||!this.data.time)return null;for(e=e?parseInt(e):0,r=r?parseInt(r):this.data[t].length-1,p=this.data.time.slice(e,+r+1||9e9),v=this.data[t].slice(e,+r+1||9e9),this.data.moving&&(l=this.data.moving.slice(e,+r+1||9e9)),i="cadence"===t,h=0,d=0,o=c=0,u=v.length;u>c;o=++c)m=v[o],null!=l&&!l[o]||i&&0===m||(n=0,o>0&&(n=p[o]-p[o-1]),h+=m*n,d+=n);return"velocity_smooth"===t||"velocity"===t?this.data.distance?(a=this.data.distance[r]-this.data.distance[e],s=d/3600,a/s):null:d>0?h/d:null},r.prototype.estimatedPowerBuckets=function(){var t,e,r,n,a,i;if(null==this.data.watts_calc)return{};for(e=[],a=0,n=0,this.data.watts_calc.forEach(function(t){return function(r,i){var s,o,c;return s=t.data.time[i],c=s-a,a=s,o=Math.round(r),null!=e[o]?e[o]+=c:e[o]=c,o>n?n=o:void 0}}(this)),t=r=0,i=n;i>=r;t=r+=1)null==e[t]&&(e[t]=0);return e},r.prototype.time=function(){return null==this.data.time?null:this.data.time[this.data.time.length-1]-this.data.time[0]},r.prototype.getSmoothPace=function(t,e){var r,n,a,i,s,o,c,u,l,d,h,p,v,m,f,g,S,y,_,w,b,L,M,T;for(null==e&&(e="pace"),u="grade_adjusted_pace"===e?"grade_adjusted_distance":"distance",c=this.get("distance"),m=this.getInMeters("distance"),g=this.getInMeters(u),L=this.get("time"),i=1/this.conversionToMeters("distance"),p=m.length,M=m[p-1],T=t/i,l=T/2,w={time:[],distance:[],pace:[]},h=-1,r=l/2,n=d=0,S=M+r,y=l;y>0?S>=d:d>=S;n=d+=y)v=d3.bisectLeft(m,n-l,0),_=d3.bisectLeft(m,n+l,v,p-1),a=d3.bisectLeft(m,n,v,_),a!==h&&(w.time.push(L[a]),w.distance.push(c[a]),o=L[_]-L[v],s=g[_]-g[v],o>0&&s>0?(b=s/o,f=1/(b*i)):f=w.pace[w.pace.length-1]||0,w.pace.push(f),h=a);return[w.pace,w.distance,w.time]},r.prototype.splits=function(){return this.cachedSplits||(this.cachedSplits=this.splitsForDistanceUnit())},r.prototype.fullSplit=function(){return this.cachedFullSplit||(this.cachedFullSplit=new Strava.Labs.Activities.StreamSplit(this,0,this.length()-1))},r.prototype.splitsForDistanceUnit=function(){var t,e,r,n;return n=this.all(),e=function(t){return function(e,r,n){return new Strava.Labs.Activities.StreamSplit(t,r,n)}}(this),r=this.bucketedIndices(this.get("distance"),1,e),0===r.length?[]:(t=r.length,r.forEach(function(e,r){var n,a,i;return n=e.distance(),i=d3.round(n,1),a=r===t-1&&1>i?(new Strava.I18n.ChartLabelDistanceFormatter).format(n):r+1,e.setLabel(a)}),parseFloat(r[t-1].distance())>=.1||r.pop(),r)},r.prototype.bucketedIndices=function(t,e,r){var n,a,i,s,o,c,u,l,d,h;if(h=0,s=Math.ceil(d3.max(t)/e)*e,e>s)return[];for(l=[],n=i=o=e,c=s,u=e;u>0?c>=i:i>=c;n=i+=u)a=d3.bisectLeft(t,n,h),a===t.length&&(a-=1),d=r(t,h,a),h=a,l.push(d);return l},r.prototype.addIntegratedSeries=function(t,e,r){var n,a,i,s,o,c;if(null!=this.derivedData[r])return this.derivedData[r];if(o=this.data[t],c=this.data[e],null!=o&&null!=c){for(i=[0],n=a=1,s=c.length-1;s>=a;n=a+=1)i[n]=i[n-1]+c[n]*(o[n]-o[n-1]);return this.derivedData[r]=i,i}return null},r.prototype.maxSlopeSubstream=function(t,e,r){var n,a,i,s,o,c,u,l,d;if(d=this.derivedData[t],c=this.data[r],null==d||null==c)return null;for(o=[0,0],s=0,n=null,i=0,l=c.length-1,u=i,a=i;l>a;){for(;l>a&&c[a]-c[u]<e;)a+=1;for(;c[a]-c[u+1]>=e;)u+=1;c[a]-c[u]>=e&&(n=(d[a]-d[u])/(c[a]-c[u]),n>s&&(o=[u,a],s=n)),u+=1}return[e,o[0],o[1],Math.round(s)]},r.prototype.maxForInterval=function(t,e,r){return this.data[t]?d3.max(this.data[t].slice(e,r+1)):0},r}(Strava.Base)}.call(this),function(){Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.StreamTransform=function(){function t(){}return t.prototype.transform=function(t,e){return e},t.prototype.dependentStreams=function(){return[]},t}()}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var a in r)e.call(r,a)&&(t[a]=r[a]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.ConvertedUnitStreamTransform=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.transform=function(t,e){var r,n,a;return a=this.constructor,n=function(){switch(t){case"distance":case"grade_adjusted_distance":case"altitude":return r=a.metersToConverted(t),function(t){return r*t};case"grade_adjusted_pace":case"pace":case"instantaneous_pace":case"instantaneous_grade_adjusted_pace":return r=a.metersToConverted(t),function(t){return t/r};case"velocity":case"velocity_smooth":return r=a.metersToConverted(t),function(t){return t*r*3600};case"temp":return a.getMeasurementUnits().tempConvert;default:return null}}(),n?e.map(n):e},r.getMeasurementUnits=function(){return strava.i18n.measurementUnits()},r.metersToConverted=function(t){var e;switch(e=this.getMeasurementUnits(),t){case"distance":case"grade_adjusted_distance":case"pace":case"grade_adjusted_pace":case"velocity":case"velocity_smooth":case"instantaneous_pace":case"instantaneous_grade_adjusted_pace":return e.longConvert;case"altitude":return e.shortConvert;default:return 1}},r.convertedToMeters=function(t){return 1/this.metersToConverted(t)},r.conversions=function(){return["distance","grade_adjusted_distance","altitude"].reduce(function(t){return function(e,r){return e[r]=t.convertedToMeters(r),e}}(this),{})},r}(Strava.Labs.Activities.StreamTransform)}.call(this),function(){Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.StreamsRequest=function(){function t(t){this.streams=t,this.reset()}return t.prototype.reset=function(){return this.required=[],this.deferred=new jQuery.Deferred},t.prototype.require=function(t,e){return this.required=_.uniq(this.required.concat(t)),e&&null!=e.onReady?this.onReady(e.onReady):void 0},t.prototype.request=function(){return 0!==this.required.length?this.streams.fetchStreams(this.required,{success:function(t){return function(){return t.deferred.resolve(),t.reset()}}(this),error:function(t){return function(){return t.deferred.reject(),t.deferred=new jQuery.Deferred}}(this)}):void 0},t.prototype.onReady=function(t){return this.deferred.done(t)},t.prototype.onError=function(t){return this.deferred.fail(t)},t}()}.call(this),function(){Strava.module("Strava.Logging"),Strava.Logging.AjaxLatency=function(){function t(){}var e,r,n;return e="/logging/v1/ajax_latency",r=0,n=0,t.logActivityStreams=!1,t.logSegmentStreams=!1,t.activityStreams=function(t,n,a){return Strava.Logging.AjaxLatency.logActivityStreams?(r++,jQuery.ajax({type:"POST",url:e,data:{metric:"activity_streams",latency:(a/1e3).toFixed(3),details:{request_number:r,types:n,types_count:n.length,activity_id:t},dataType:"json"}})):void 0},t.segmentStreams=function(t,r,a){return Strava.Logging.AjaxLatency.logSegmentStreams?(n++,jQuery.ajax({type:"POST",url:e,data:{metric:"segment_streams",latency:(a/1e3).toFixed(3),details:{request_number:n,types:r,types_count:r.length,segment_id:t},dataType:"json"}})):void 0},t}()}.call(this),function(){var t,e,r,n=function(t,e){function r(){this.constructor=t}for(var n in e)a.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},a={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),r=function(t,e,r){return strava.Math.calculateSpeed(t,e,r,100,3,2)},e=function(t,e,n){var a,i,s,o,c;for(s=r(t,e,n),o=[],a=0,i=s.length;i>a;a++)c=s[a],o.push(0===c?0:1/c);return o},t=function(t,e){var r,n;return n=function(){var n,a,i;for(i=[],r=n=1,a=t.length-1;a>=1?a>=n:n>=a;r=a>=1?++n:--n)i.push((t[r]-t[r-1])/(e[r]-e[r-1]));return i}()},Strava.Labs.Activities.Streams=function(a){function i(t,e,r){null==r&&(r=!1),this.activityId=t,this.streamData=new Strava.Labs.Activities.StreamData,this.requestedTypes=[],this.reduce=e,this.loggedOut=r,i.__super__.constructor.call(this)}var s,o;return n(i,a),i.calculateSpeed=r,i.calculatePace=e,i.calculateDerivative=t,o=["latlng","time","distance","velocity_smooth","watts","watts_calc","grade_adjusted_distance","grade_smooth","heartrate","cadence","resting","altitude","temp","outlier","moving","timer_time"],s={pace:{required:["distance","time"],convert:function(t){var e,r,n;return n=t.get("time"),r=t.get("distance"),e=!0,Strava.Labs.Activities.Streams.calculatePace(r,n,e)}},grade_adjusted_pace:{required:["grade_adjusted_distance","time","altitude"],convert:function(t){var e,r,n;return n=t.get("time"),r=t.get("grade_adjusted_distance"),e=!0,Strava.Labs.Activities.Streams.calculatePace(r,n,e)}},velocity:{required:["distance","time"],convert:function(t){var e,r,n;return n=t.get("time"),r=t.get("distance"),e=!1,Strava.Labs.Activities.Streams.calculateSpeed(r,n,e)}},instantaneous_speed:{required:["distance","time"],convert:function(t){var e,r,n;return r=t.get("time"),e=t.get("distance"),n=Strava.Labs.Activities.Streams.calculateDerivative(e,r),n.unshift(0),n}},instantaneous_acceleration:{required:["instantaneous_speed","time"],convert:function(t){var e,r,n;return r=t.get("time"),e=t.get("instantaneous_speed"),n=Strava.Labs.Activities.Streams.calculateDerivative(e,r),n.unshift(0),n}},instantaneous_pace:{required:["instantaneous_speed"],convert:function(t){var e;return e=t.get("instantaneous_speed"),e.map(function(t){return 1/t})}},instantaneous_grade_adjusted_pace:{required:["grade_adjusted_distance","time"],convert:function(t){var e,r,n;return r=t.get("time"),e=t.get("grade_adjusted_distance"),n=Strava.Labs.Activities.Streams.calculateDerivative(e,r),n.unshift(0),n.map(function(t){return 1/t})}}},i.LOCAL_STREAMS=s,i.REMOTE_STREAMS=o,i.prototype.fetchStreams=function(t,e){var r,n,a,i,s,o,c,u,l;return o=this.classifyTypes(t),u=o[0],n=o[1],r=this.dependentsOf(n),l=_.uniq(t.concat(r)),a=this.neededTypes(l),c=this.classifyTypes(a),s=c[0],i=c[1],this.fetchRemote(s,{success:function(t){return function(r){var n;return n=_.extend(r,t.fetchLocal(i)),t.trigger("fetchSuccess",t.availableStreams()),e.success()}}(this),error:e.error})},i.prototype.localTypes=function(){return Object.keys(s)},i.prototype.streamParentType=function(){return"activity"},i.prototype.classifyTypes=function(t){var e,r;return r=_.intersection(t,o),e=_.intersection(t,this.localTypes()),[r,e]},i.prototype.dependentsOf=function(t){var e,r,n,a;for(e=[],r=0,n=t.length;n>r;r++)a=t[r],e=_.uniq(e.concat(s[a].required));return e},i.prototype.cachedTypes=function(){return this.streamData.types()},i.prototype.handleStreamsFetched=function(t,e){return this.addRequestedTypes(t),this.setStreamsFromResponse(e)},i.prototype.fetchRemote=function(t,e){var r,n;return t.length>0?(n=new Date,r={type:"GET",url:this.fetchUrl(),data:this.fetchData(t),cache:!1,success:function(r){return function(a,i){var s;return s=new Date,"activity"===r.streamParentType()&&Strava.Logging.AjaxLatency.activityStreams(r.activityId,t,s.getTime()-n.getTime()),"segment"===r.streamParentType()&&Strava.Logging.AjaxLatency.segmentStreams(r.segmentId,t,s.getTime()-n.getTime()),r.handleStreamsFetched(t,i),e.success(i)}}(this),error:e.error},null!=this.reduce&&(r.reduce=this.reduce),this.fetch(r)):e.success({})},i.prototype.fetchUrl=function(){return this.loggedOut?"/stream/"+this.activityId:"/activities/"+this.activityId+"/streams"},i.prototype.fetchData=function(t){return this.loggedOut?{streams:t}:{stream_types:t}},i.prototype.fetchLocal=function(t){var e,r,n,a,i,o;for(r={},n=0,a=t.length;a>n;n++)o=t[n],e=s[o],this.streamsFetched(e.required)&&(i=e.convert(this.streamData),this.streamData.add(o,i),r[o]=i);return r},i.prototype.neededTypes=function(t){var e;return e=this.cachedTypes(),_.difference(t,e,this.requestedTypes)},i.prototype.addRequestedTypes=function(t){return this.requestedTypes=_.union(this.requestedTypes,t)},i.prototype.setStreamsFromResponse=function(t){var e,r,n;e=[];for(n in t)r=t[n],e.push(this.streamData.add(n,r));return e},i.prototype.streamsFetched=function(t){return t.every(function(t){return function(e){return t.streamFetched(e)}}(this))},i.prototype.streamFetched=function(t){return this.streamData.has(t)},i.prototype.getStream=function(t){return this.streamData.get(t)},i.prototype.availableStreams=function(){return this.streamData.all()},i}(Backbone.Model)}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var a in r)e.call(r,a)&&(t[a]=r[a]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.EqualLengthMovingTimeStreamTransform=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.transform=function(t,e){var r,n,a,i,s,o,c,u;switch(t){case"resting":return this.resting=e,e;case"time":if(null==this.resting)return[];for(c=0,r=0,a=[],i=s=0,o=e.length;o>s;i=++s)u=e[i],n=u-c,this.resting[i]||(r+=n),a.push(r),c=u;return this.filtered_time=a,a;case"pace":return Strava.Labs.Activities.Streams.calculatePace(this.filtered_distance,this.filtered_time,!0);case"grade_adjusted_pace":return Strava.Labs.Activities.Streams.calculatePace(this.filtered_grade_adjusted_distance,this.filtered_time,!0);case"velocity":return Strava.Labs.Activities.Streams.calculateSpeed(this.filtered_distance,this.filtered_time,!1);default:return null==this.resting?[]:(("distance"===t||"grade_adjusted_distance"===t)&&(this["filtered_"+t]=e),e)}},r.prototype.dependentStreams=function(){return["resting"]},r}(Strava.Labs.Activities.StreamTransform)}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var a in r)e.call(r,a)&&(t[a]=r[a]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.MovingTimeStreamTransform=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.transform=function(t,e){var r,n,a,i,s,o,c,u;switch(t){case"resting":return this.resting=e,e.filter(function(t){return function(e,r){return!t.resting[r]}}(this));case"time":if(null==this.resting)return[];for(c=0,r=0,a=[],i=s=0,o=e.length;o>s;i=++s)u=e[i],n=u-c,this.resting[i]||(r+=n,a.push(r)),c=u;return this.filtered_time=a,a;case"pace":return Strava.Labs.Activities.Streams.calculatePace(this.filtered_distance,this.filtered_time,!0);case"grade_adjusted_pace":return Strava.Labs.Activities.Streams.calculatePace(this.filtered_grade_adjusted_distance,this.filtered_time,!0);case"velocity":return Strava.Labs.Activities.Streams.calculateSpeed(this.filtered_distance,this.filtered_time,!1);default:return null==this.resting?[]:(a=e.filter(function(t){return function(e,r){return!t.resting[r]}}(this)),("distance"===t||"grade_adjusted_distance"===t)&&(this["filtered_"+t]=a),a)}},r.prototype.dependentStreams=function(){return["resting"]},r}(Strava.Labs.Activities.StreamTransform)}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var a in r)e.call(r,a)&&(t[a]=r[a]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.TimerTimeStreamTransform=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.transform=function(t,e){switch(t){case"timer_time":return this.timer_time=e;case"time":return null==this.timer_time?[]:this.timer_time;case"resting":return e.map(function(){return function(){return!1}}(this));case"pace":return Strava.Labs.Activities.Streams.calculatePace(this.distance,this.timer_time,!0);case"grade_adjusted_pace":return Strava.Labs.Activities.Streams.calculatePace(this.grade_adjusted_distance,this.timer_time,!0);case"velocity":return Strava.Labs.Activities.Streams.calculateSpeed(this.distance,this.timer_time,!1);default:return null==this.timer_time?[]:(("distance"===t||"grade_adjusted_distance"===t)&&(this[t]=e),e)}},r.prototype.dependentStreams=function(){return["timer_time"]},r}(Strava.Labs.Activities.StreamTransform)}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var a in r)e.call(r,a)&&(t[a]=r[a]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.ConvertedSwimUnitStreamTransform=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.transform=function(t,e){var r,n,a;return a=this.constructor,n=function(){switch(t){case"distance":case"altitude":return r=a.metersToConverted(t),function(t){return r*t};case"pace":return r=a.metersToConverted(t),function(t){return 100*r*t};case"temp":return a.getMeasurementUnits().tempConvert;default:return null}}(),n?e.map(n):e},r.getMeasurementUnits=function(){return strava.i18n.measurementUnits()},r.metersToConverted=function(t){var e;switch(e=this.getMeasurementUnits(),t){case"distance":case"pace":return e.mediumConvert;case"altitude":return e.shortConvert;default:return 1}},r}(Strava.Labs.Activities.ConvertedUnitStreamTransform)}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var a in r)e.call(r,a)&&(t[a]=r[a]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.StreamTransformSet=function(e){function r(t){this.initializeAttributes(n),this.transforms=t.map(function(t){return new t})}var n;return t(r,e),n={conversionsToMeters:{}},r.CONVERTED_MOVING_TIME="converted-moving-time",r.CONVERTED_ELAPSED_TIME="converted-elapsed-time",r.CONVERTED_TIMER_TIME="converted-timer-time",r.CONVERTED_SWIM_MOVING_TIME="converted-swim-moving-time",r.get=function(t){var e,r;switch(e=this,t){case e.CONVERTED_MOVING_TIME:return r=new e([Strava.Labs.Activities.EqualLengthMovingTimeStreamTransform,Strava.Labs.Activities.ConvertedUnitStreamTransform]),r.conversionsToMeters(Strava.Labs.Activities.ConvertedUnitStreamTransform.conversions());case e.CONVERTED_ELAPSED_TIME:return r=new e([Strava.Labs.Activities.ConvertedUnitStreamTransform]),r.conversionsToMeters(Strava.Labs.Activities.ConvertedUnitStreamTransform.conversions());case e.CONVERTED_SWIM_MOVING_TIME:return r=new e([Strava.Labs.Activities.EqualLengthMovingTimeStreamTransform,Strava.Labs.Activities.ConvertedSwimUnitStreamTransform]),r.conversionsToMeters(Strava.Labs.Activities.ConvertedSwimUnitStreamTransform.conversions());case e.CONVERTED_TIMER_TIME:return r=new e([Strava.Labs.Activities.TimerTimeStreamTransform,Strava.Labs.Activities.ConvertedUnitStreamTransform]),r.conversionsToMeters(Strava.Labs.Activities.ConvertedUnitStreamTransform.conversions());default:return new e([])}},r.prototype.dependentStreams=function(){return this.transforms.reduce(function(t,e){return _.union(t,e.dependentStreams())},[])},r.prototype.transform=function(t,e){var r;return r=e,this.transforms.forEach(function(e){return r=e.transform(t,r)}),r},r}(Strava.Base)}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var a in r)e.call(r,a)&&(t[a]=r[a]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.PointsOfInterest=function(e){function r(t,e,n){null==t&&(t={}),this.splits=n,r.__super__.constructor.call(this),this.data=t,this.initializePOIScale(e)}return t(r,e),r.prototype.initializePOIScale=function(t){var e,r,n,a,i,s,o,c,u,l,d,h;for(u=1609.34,a=function(){switch(!1){case"meters"!==t:return 1e3;case"feet"!==t:return u}}(),c=42195,h=10*u,e=50*u,r=c/2,this.configuration=[{type:"5k",pois:function(){var t,e,r,n;for(n=[],s=t=e=a,r=a;r>0?4999>=t:t>=4999;s=t+=r)n.push(s);return n}(),usesSplits:!0,distance:5e3,range:[4500,5500]},{type:"10k",pois:function(){var t,e,r,n;for(n=[],s=t=e=a,r=a;r>0?9999>=t:t>=9999;s=t+=r)n.push(s);return n}(),usesSplits:!0,distance:1e4,range:[9500,10500]},{type:"halfmarathon",pois:function(){var t,e,n;for(n=[],s=t=5e3,e=r;e>=t;s=t+=5e3)n.push(s);return n}(),distance:r,range:[r-1e3,r+500]},{type:"marathon",pois:function(){var t,e,r;for(r=[],s=t=5e3,e=c;e>=t;s=t+=5e3)r.push(s);return r}(),distance:c,range:[c-2700,c+2700]}],n=[{feet:{type:"50mi",pois:function(){var t,e;for(e=[],s=t=10;40>=t;s=t+=10)e.push(s*u);return e}(),distance:e,range:[e-7e3,e+7e3]},meters:{type:"50mi",pois:function(){var t,r,n;for(n=[],s=t=2e4,r=e;r>=t;s=t+=2e4)n.push(s);return n}(),distance:e,range:[e-7e3,e+7e3]}}],d=[],i=0,o=n.length;o>i;i++)l=n[i],l[t]&&d.push(this.configuration.push(l[t]));return d},r.prototype.getStandardPOI=function(t){var e,r,n,a;for(a=this.configuration,e=0,r=a.length;r>e;e++)if(n=a[e],this.inRange(t,n.range))return n},r.prototype.getPOI=function(t){var e,r,n;return r=this.getStandardPOI(t),r||(n=t/4,r={type:"undefined",pois:function(){var r,a,i,s,o;for(o=[],e=r=a=n,i=t-n,s=n;s>0?i>=r:r>=i;e=r+=s)o.push(e);return o}(),labels:["25%","50%","75%"],distance:t}),r},r.prototype.inRange=function(t,e){return t>=e[0]&&t<=e[1]},r.prototype.pointsOfInterest=function(){var t,e,r,n,a,i,s,o,c,u;return n=this.data.distance,s=n.length,e=this.getPOI(n[s-1]),t=e.pois,c=this.data.time,e.usesSplits&&this.splits.length>=t.length?(u=0,o=function(){var n,i,s;for(s=[],a=n=0,i=t.length;i>n;a=++n)r=t[a],u+=this.splits[a].pace(),s.push({distance:r,time:u,race_type:e.type,isHalfMarathon:21097.5===r,isFinish:!1,label:void 0});return s}.call(this)):(i=0,o=function(){var o,u,l;for(l=[],a=o=0,u=t.length;u>o;a=++o)r=t[a],r>n[s-1]||l.push(function(t){var r;return i=d3.bisectLeft(n,t,i),r=e.labels?e.labels[a]:void 0,{distance:t,time:c[i],race_type:e.type,isHalfMarathon:21097.5===t,isFinish:!1,label:r}}(r));return l}()),o.push({distance:n[s-1],time:c[c.length-1],race_type:e.type,isHalfMarathon:!1,isFinish:!0}),o},r}(Strava.Base)}.call(this),function(){Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.StreamsContext=function(){function t(t,e){this.streams=t,this.streams.bind("fetchSuccess",function(t){return function(e){return t.handleFetchSuccess(e)}}(this)),this.transformSet=Strava.Labs.Activities.StreamTransformSet.get(e),this.data=new Strava.Labs.Activities.StreamData({},this.transformSet.conversionsToMeters())}return Strava.includeModule(t,Backbone.Events),t.prototype.handleFetchSuccess=function(t){var e,r,n,a,i,s,o;for(e=Object.keys(t),o=_.difference(e,this.data.types()),r=this.transformSet.dependentStreams(),i=_.sortBy(o,function(t){var e;return e=r.indexOf(t),e>-1?e:1/0}),n=0,a=i.length;a>n;n++)s=i[n],this.transform(s,t[s]);return this.trigger("fetchSuccess")},t.prototype.transform=function(t,e){var r;return this.data.has(t)?this.data.get(t):(r=this.transformSet.transform(t,e),this.data.add(t,r),r)},t.prototype.get=function(t){return this.data.get(t)},t.prototype.getInMeters=function(t){return this.data.getInMeters(t)},t.prototype.streamFetched=function(t){return this.data.has(t)},t.prototype.valueAt=function(t,e){return this.data.has(t)?this.data.get(t)[e]:void 0},t.prototype.setValueAt=function(t,e,r){return null==r&&(r=0),this.data.get(t)[e]=r,this.trigger("streamsDataChanged")},t.prototype.valuesAt=function(t){var e,r,n,a;a={},e=this.data.all();for(n in e)r=e[n],a[n]=r[t];return a},t.prototype.length=function(){return this.data.length()},t.prototype.splits=function(){return this.data.splits()},t.prototype.pointsOfInterest=function(t){return this.poi?this.poi.pointsOfInterest():(this.poi=new Strava.Labs.Activities.PointsOfInterest({time:this.get("time"),distance:this.getInMeters("distance")},t,this.splits()),this.poi.pointsOfInterest())},t.prototype.createRequest=function(){var t;return t=new Strava.Labs.Activities.StreamsRequest(this.streams),t.require(this.transformSet.dependentStreams()),t},t}()}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var a in r)e.call(r,a)&&(t[a]=r[a]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Segments"),Strava.Labs.Segments.Streams=function(e){function r(t){this.segmentId=t}return t(r,e),r.prototype.fetchStreams=function(){var t;return t={url:"/stream/segments/"+this.segmentId,type:"GET",cache:!1},jQuery.ajax(t)},r}(Strava.Base)}.call(this),function(){var t;Strava.module("Strava.Segments.StreamContextRegistry"),t={},Strava.Segments.StreamContextRegistry.contextFor=function(e){var r,n,a,i;return null!=t[e]?t[e]:(a=new Strava.Segments.Streams(e,!1),i=new Strava.Labs.Activities.StreamsContext(a,null),n=i.createRequest(),r=new Strava.Labs.Activities.EventDispatcher,t[e]={request:n,context:i,eventDispatcher:r},t[e])}}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var a in r)e.call(r,a)&&(t[a]=r[a]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Segments"),Strava.Segments.Streams=function(e){function r(t,e){this.segmentId=t,r.__super__.constructor.call(this,null,e)}return t(r,e),r.prototype.streamParentType=function(){return"segment"},r.prototype.fetchUrl=function(){return"/stream/segments/"+this.segmentId},r.prototype.fetchData=function(t){return{streams:t}},r}(Strava.Labs.Activities.Streams)}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var a in r)e.call(r,a)&&(t[a]=r[a]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Models"),Strava.Models.Athlete=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.className="Athlete",r.prototype.tabelized="athletes",r.prototype.urlRoot="/athletes",r}(Backbone.Model)}.call(this),function(){var t=function(t,r){function n(){this.constructor=t}for(var a in r)e.call(r,a)&&(t[a]=r[a]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Segments.Garmin"),Strava.Segments.Garmin.PopularSegmentsEnabledView=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.events={"change input":"handlePreferenceChange"},r.prototype.handlePreferenceChange=function(t){var e,r;return e=this.$(t.target),r=this.$el.find(".saved-js"),jQuery.ajax({url:"/athlete/segments/garmin_popular_segments_enabled",data:{value:e.val()},type:"PUT",success:function(){return r.fadeIn(100,function(){return window.setTimeout(function(){return r.fadeOut(1e3)},1e3)})}})},r}(Backbone.View)}.call(this);