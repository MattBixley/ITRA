(function(){var t=function(t,r){function i(){this.constructor=t}for(var o in r)e.call(r,o)&&(t[o]=r[o]);return i.prototype=r.prototype,t.prototype=new i,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Segments.History"),Strava.Segments.History.SegmentEffort=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.startDate=function(){return this.startDateLocal||(this.startDateLocal=new Date(this.get("start_date_local")))},r.prototype.duration=function(){return this.get("elapsed_time")},r.prototype.activityId=function(){return this.get("activity_id")},r.prototype.activityName=function(){return this.get("activity").name},r.prototype.rank=function(){return this.get("athlete_rank")},r}(Backbone.Model)}).call(this),function(){var t=function(t,r){function i(){this.constructor=t}for(var o in r)e.call(r,o)&&(t[o]=r[o]);return i.prototype=r.prototype,t.prototype=new i,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Segments.History"),Strava.Segments.History.BestEfforts=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.model=Strava.Segments.History.SegmentEffort,r.prototype.personalBest=function(){return this.length>0?this.at(0):null},r}(Backbone.Collection)}.call(this),function(){var t=function(t,r){function i(){this.constructor=t}for(var o in r)e.call(r,o)&&(t[o]=r[o]);return i.prototype=r.prototype,t.prototype=new i,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Segments.History"),Strava.Segments.History.HistoryWindow=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.model=Strava.Segments.History.SegmentEffort,r.prototype.efforts=function(){return this.models},r.prototype.width=function(){return this.models.length},r.prototype.indexOf=function(t){var e,r,i,o,s,a;for(i=-1,a=this.models,r=o=0,s=a.length;s>o;r=++o)if(e=a[r],e.id===t.id){i=r;break}return i},r.prototype.first=function(){return this.at(0)},r.prototype.yearsGroups=function(){return this._yearGroups||(this._yearGroups=Strava.Segments.History.EffortYearGroups.build(this.models))},r}(Backbone.Collection)}.call(this),function(){var t=function(t,r){function i(){this.constructor=t}for(var o in r)e.call(r,o)&&(t[o]=r[o]);return i.prototype=r.prototype,t.prototype=new i,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Segments.History"),Strava.Segments.History.Segment=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}var i;return t(r,e),i=9,r.prototype.distance=function(){return this.get("distance")},r.prototype.isRun=function(){return this.get("activity_type")===i},r}(Backbone.Model)}.call(this),function(){var t=function(t,r){function i(){this.constructor=t}for(var o in r)e.call(r,o)&&(t[o]=r[o]);return i.prototype=r.prototype,t.prototype=new i,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Segments.History"),Strava.Segments.History.AthleteSegmentHistory=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.url=function(){return"/athlete/segments/"+this.id+"/history"},r.prototype.parse=function(t){var e;return e={historyWindow:new Strava.Segments.History.HistoryWindow(t.efforts),kom:new Strava.Segments.History.SegmentEffort(t.kom),qom:new Strava.Segments.History.SegmentEffort(t.qom),bestEfforts:new Strava.Segments.History.BestEfforts(t.athlete_best_efforts),segment:new Strava.Segments.History.Segment(t.segment),athlete_effort_count:t.athlete_effort_count}},r.prototype.historyWindow=function(){return this.get("historyWindow")},r.prototype.bestEfforts=function(){return this.get("bestEfforts")},r.prototype.effortDomain=function(){var t,e,r,i,o,s;if(0===this.historyWindow().width())return[0,0];if(1===this.historyWindow().width())return e=this.historyWindow().first().duration(),[3*e/4,5*e/4];for(s=0,o=this.historyWindow().efforts(),r=0,i=o.length;i>r;r++)t=o[r],t.duration()>s&&(s=t.duration());return[this.bestEfforts().personalBest().duration(),s]},r.prototype.segment=function(){return this.get("segment")},r.prototype.totalEffortCount=function(){return this.get("athlete_effort_count")},r}(Backbone.Model)}.call(this),function(){Strava.module("Strava.D3.Charts"),Strava.D3.Charts.Util={autoDomain:function(t,e){var r,i,o,s,a,n,h,l,c,p;return null==e&&(e={}),_.defaults(e,{paddingBottom:0,paddingTop:0,innerClamp:0}),i=d3.extent(t),s=i[0],o=i[1],n=o-s,e.outerClamp||(e.outerClamp=d3.max([e.innerClamp,n])),r=100-(e.paddingBottom+e.paddingTop),e.innerRange||(e.innerRange=r),p=d3.scale.linear().domain([e.innerClamp,e.outerClamp]).range([e.innerRange,r]).clamp(!0),a=p(n),h=e.paddingBottom+r/2,c=[h-a/2,h+a/2],l=d3.scale.linear().domain(i).range(c),[l.invert(0),l.invert(100)]},closestOrdinalValue:function(t,e){var r,i,o,s,a,n,h;for(n=e.range(),i=o=0,s=n.length;s>o;i=++o)if(h=n[i],h>t||i===n.length-1?r=i:(a=n[i+1],a>t&&(r=a-t>t-h?i:i+1)),"number"==typeof r)return e.domain()[r]},getPathPositionAt:function(t,e){var r,i,o,s;for(o=e,r=t.getTotalLength(),s=null;;){if(s=Math.floor((o+r)/2),i=t.getPointAtLength(s),(s===r||s===o)&&i.x!==e)break;if(i.x>e)r=s;else{if(!(i.x<e))break;o=s}}return i},niceTimeTicks:function(t,e){var r,i,o;return o=t.map(function(t){return new Date(d3.round(1e3*t))}),r=d3.time.scale().domain(o),i=r.ticks(e),i.map(function(t){return t.getTime()/1e3})}}}.call(this),function(){var t=function(t,r){function i(){this.constructor=t}for(var o in r)e.call(r,o)&&(t[o]=r[o]);return i.prototype=r.prototype,t.prototype=new i,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Segments.History"),Strava.Segments.History.AthleteSegmentHistoryChart=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}var i,o,s;return t(r,e),r.prototype.CONTAINER_HEIGHT=400,r.prototype.CONTAINER_HEIGHT_SINGLE_EFFORT=300,r.prototype.CONTAINER_WIDTH=1148,r.prototype.X_AXIS_BOTTOM_MARGIN=70,r.prototype.Y_AXIS_LEFT_MARGIN=50,r.prototype.Y_TICK_COUNT=5,r.prototype.MAX_WINDOW_SIZE=40,r.prototype.CHART_RIGHT_MARGIN=40,r.prototype.DEFAULT_CHART_MARGIN=(r.prototype.CONTAINER_WIDTH-r.prototype.Y_AXIS_LEFT_MARGIN)/r.prototype.MAX_WINDOW_SIZE,r.prototype.MARK_RADIUS=3,r.prototype.PR_MARK_RADIUS=4,i={MARGIN_TOP:14,WIDTH:220,HEIGHT:60,PADDING_LEFT:10,PADDING_TOP:5,LINE_HEIGHT:21},o=30,s=24,r.prototype.el="#athlete-history-chart",r.prototype.initialize=function(t){return this.historyWindow=this.model.historyWindow(),this.bestEfforts=this.model.bestEfforts(),this.segment=this.model.segment(),this.prAssetPath=t.prAssetPath},r.prototype.render=function(){var t,e,r,i;return i=this.historyWindow.indexOf(this.bestEfforts.personalBest()),t=i>=0?1:2,0===this.historyWindow.width()?void this.$el.height(0):(1===this.historyWindow.width()?(e=this.CONTAINER_HEIGHT_SINGLE_EFFORT,t=3,this.$el.height(e)):e=this.CONTAINER_HEIGHT,this.margins={top:0,right:this.CHART_RIGHT_MARGIN,bottom:this.X_AXIS_BOTTOM_MARGIN,left:this.Y_AXIS_LEFT_MARGIN+this.DEFAULT_CHART_MARGIN*t},this.width=this.getContainerWidth()-this.margins.left-this.margins.right,this.height=e-this.margins.top-this.margins.bottom,this.xScale=this.xScale(),this.yScale=this.yScale(),this.svg=d3.select("#athlete-history-chart").append("svg").attr("width",this.getContainerWidth()).attr("height",e).append("g").attr("transform","translate("+this.margins.left+", "+this.margins.top+")"),this.chartMargin=this.DEFAULT_CHART_MARGIN*t,this.drawXAxis(i>=0,this.bestEfforts.personalBest().startDate().getFullYear()),this.drawYAxis(),this.completeXAxis(),this.styleTicks(),this.marks=this.historyWindow.efforts().map(function(t,e){return[e,-1*t.duration()]}),this.drawGrid(),1!==this.historyWindow.width()&&this.drawPersonalBestLine(this.bestEfforts.personalBest()),0>i?this.drawPastPersonalBestBox(this.bestEfforts.personalBest()):this.lineLayer=this.svg.append("g"),this.drawMarks(),i>=0&&this.drawPersonalBestMark(this.bestEfforts.personalBest(),i),this.effortBox=this.createEffortBox(),this.selectedIndex=this.historyWindow.length-1,r=this.historyWindow.at(this.selectedIndex),this.drawLinesToEffort(this.selectedIndex,r,"vgrid-selected","hgrid-selected"),this.selectEffort(this.selectedIndex,-this.chartMargin,this.xScale,this.yScale)())},r.prototype.getContainerWidth=function(){return this.$el.width()||this.CONTAINER_WIDTH},r.prototype.xScale=function(){return d3.scale.linear().range([0,this.width]).domain([0,this.historyWindow.length])},r.prototype.yScale=function(){var t,e,r,i;return i=this.model.effortDomain(),r=i[0],e=i[1],t=(e-r)/2,d3.scale.linear().range([this.height,0]).domain([-(e+t/1.3),-(r-1.1*t)])},r.prototype.drawXAxis=function(t,e){var r,i,o;return i=this.monthTicks(),r=TwitterCldr.Calendar.months({format:"stand-alone",names_form:"abbreviated"}),o=d3.svg.axis().scale(this.xScale).orient("bottom").tickValues(i).tickFormat(function(t){return function(e){return r[t.historyWindow.efforts()[e].startDate().getMonth()]}}(this)),this.svg.append("g").classed("x axis",!0).attr("transform","translate(0, "+this.height+")").call(o),this.drawYears(t,e)},r.prototype.monthTicks=function(){var t,e,r,i,o,s,a,n,h,l;for(l=[],o=null,s=null,h=this.historyWindow.efforts(),n=i=0,a=h.length;a>i;n=++i)t=h[n],e=t.startDate().getMonth(),r=t.startDate().getFullYear(),(e!==o||r!==s)&&(o=e,s=r,l.push(n));return l},r.prototype.drawYAxis=function(){var t,e,r;return t=new Strava.I18n.TimespanFormatter,e=Strava.D3.Charts.Util.niceTimeTicks(this.yScale.domain(),this.Y_TICK_COUNT),r=d3.svg.axis().scale(this.yScale).orient("left").tickSize(0).tickPadding(9).tickValues(e).tickFormat(function(e){return t.display(-e)}),this.svg.append("g").classed("y axis",!0).attr("transform","translate(-"+this.chartMargin+", 0)").call(r)},r.prototype.styleTicks=function(){return d3.selectAll("g.tick").select("text").classed("axis-tick-text",!0)},r.prototype.drawGrid=function(){var t,e,r,i,o,a,n;for(a=this.marks,n=[],e=r=0,i=a.length;i>r;e=++r)o=a[e],t=this.svg.append("g"),t.append("line").classed("vgrid",!0).attr({x1:this.xScale(o[0]),x2:this.xScale(o[0]),y1:0,y2:this.height}),t.append("rect").classed("hover-target",!0).attr({x:this.xScale(o[0])-s/2,y:0,width:s,height:this.height}),n.push(t.on("mouseover",this.hoverOnEffort(e)).on("mouseout",this.hoverOutEffort()).on("click",this.selectEffort(e)));return n},r.prototype.hoverOnEffort=function(t){return function(e){return function(){var r;return t!==e.selectedIndex&&"circle"!==d3.event.relatedTarget.nodeName&&"rect"===d3.event.target.nodeName&&(r=0>t?e.bestEfforts.personalBest():e.historyWindow.at(t),e.svg.selectAll("#mark-hover").remove(),1!==r.rank())?e.svg.append("circle").attr("id","mark-hover").attr("cx",e.xScale(t)).attr("cy",e.yScale(-1*r.duration())).attr("r",5).on("click",e.selectEffort(t)):void 0}}(this)},r.prototype.hoverOutEffort=function(){return function(t){return function(){return"rect"===d3.event.relatedTarget.nodeName&&"circle"!==d3.event.target.nodeName?t.svg.selectAll("#mark-hover").remove():void 0}}(this)},r.prototype.drawLinesToEffort=function(t,e,r,i){var o;return o=this.lineLayer.append("line").attr({id:r,x1:this.xScale(t),x2:this.xScale(t),y1:this.height,y2:0}),r.indexOf("hover")>=0&&o.on("click",this.selectEffort(t)),this.lineLayer.append("line").attr({id:i,x1:-this.chartMargin,x2:this.width,y1:this.yScale(-1*e.duration()),y2:this.yScale(-1*e.duration())})},r.prototype.animateLinesToEffort=function(t,e){var r;return r=1===e.rank()?0:1,this.svg.select("#vgrid-selected").transition().duration(350).ease(d3.ease("sin-out")).attr("x1",""+this.xScale(t)).attr("x2",""+this.xScale(t)),this.svg.select("#hgrid-selected").transition().duration(350).ease(d3.ease("sin-out")).attr("y1",""+this.yScale(-1*e.duration())).attr("y2",""+this.yScale(-1*e.duration())).style("opacity",r)},r.prototype.selectEffort=function(t){return function(e){return function(){var r;return e.selectedIndex=t,e.svg.selectAll("#mark-selected").remove(),r=0>t?e.bestEfforts.personalBest():e.historyWindow.at(t),1!==r.rank()&&e.svg.append("circle").attr("id","mark-selected").attr("cx",e.xScale(t)).attr("cy",e.yScale(-1*r.duration())).attr("r",5),e.animateLinesToEffort(t,r),e.updateEffortBox(t,r)}}(this)},r.prototype.positionEffortBox=function(t,e){var r;return r=this.xScale(t),r+e>this.width&&(r-=e),this.effortBox.transition().duration(350).ease(d3.ease("sin-out")).attr("transform","translate("+r+")")},r.prototype.updateEffortBox=function(t,e){var r,s,a,n,h,l,c,p,f;return r=(new TwitterCldr.DateTimeFormatter).format(e.startDate(),{format:"date",type:"short"}),this.effortBox.select("#effort-box-activity-date").text(r),1===e.rank()?(h=i.HEIGHT-2*i.PADDING_LEFT,f=i.WIDTH+i.PADDING_LEFT+h,this.effortBox.select("#effort-box").attr({width:f}),this.effortBox.select("#effort-box-text-group").attr({transform:"translate("+(h+i.PADDING_LEFT)+")"}),this.effortBox.select("#effort-box-pr-image").attr({height:h,width:h}),this.positionEffortBox(t,f)):(this.effortBox.select("#effort-box-pr-image").attr({width:0}),this.effortBox.select("#effort-box-text-group").attr({transform:"translate(0)"}),this.effortBox.select("#effort-box").attr({width:i.WIDTH}),this.positionEffortBox(t,i.WIDTH)),s=e.activityName(),s.length>o&&(s=s.substring(0,o)+"\u2026"),this.effortBox.select("#effort-box-activity-link").attr("xlink:href","/activities/"+e.activityId()),this.effortBox.select("#effort-box-activity-name").text(s),p=new Strava.I18n.TimespanFormatter,this.effortBox.select("#effort-box-effort-duration").text(p.display(e.duration())),l=Strava.I18n.Locale.t("strava.segments.history.effort_rank",{rank:e.rank(),total:this.model.get("athlete_effort_count")}),l=jQuery("<div/>").html(l).text(),this.effortBox.select("#effort-box-effort-rank").text(l),c=this.segment.distance()/e.duration(),this.segment.isRun()?n=new Strava.I18n.PaceFormatter:(n=new Strava.I18n.DistancePerTimeFormatter,c=3600*c),a=n.formatShort(c),this.effortBox.select("#effort-box-effort-speed").text(a)},r.prototype.drawMarks=function(){var t,e,r,i,o,s;for(o=this.marks,s=[],t=e=0,r=o.length;r>e;t=++e)i=o[t],s.push(this.svg.append("circle").classed("mark",!0).attr("cx",this.xScale(i[0])).attr("cy",this.yScale(i[1])).attr("r",4).on("click",this.selectEffort(t)));return s},r.prototype.drawPersonalBestLine=function(t){var e;return null!==t?(this.svg.append("line").classed("personal-best-line",!0).attr({x1:-this.chartMargin,x2:this.width,y1:this.yScale(-t.duration()),y2:this.yScale(-t.duration())}),this.svg.append("text").text(Strava.I18n.Locale.t("strava.segments.history.pr")).classed("personal-best-label",!0).attr({x:this.width+5,y:this.yScale(-t.duration())+5}),e=new Strava.I18n.TimespanFormatter,this.svg.append("text").text(e.display(t.duration())).classed("personal-best-value",!0).attr({x:this.width+5,y:this.yScale(-t.duration())+19})):void 0},r.prototype.drawPastPersonalBestBox=function(t){return this.svg.append("defs").append("pattern").attr("id","diagonalPattern").attr("patternUnits","userSpaceOnUse").attr("width",5).attr("height",5).append("path").classed("personal-best-box-fill",!0).attr("d","m -1,-1 l 7,7"),this.svg.append("rect").classed("personal-best-box",!0).attr("x",-this.DEFAULT_CHART_MARGIN).attr("y",0).attr("width",this.xScale(1)+2).attr("height",this.height-1),this.svg.append("line").classed("vgrid",!0).attr("x1",-this.DEFAULT_CHART_MARGIN).attr("x2",-this.DEFAULT_CHART_MARGIN).attr("y1",0).attr("y2",this.height),this.svg.append("rect").classed("hover-target",!0).attr({x:-this.DEFAULT_CHART_MARGIN-s/2,y:0,width:s,height:this.height}).on("click",this.selectEffort(-(1+this.xScale.invert(2)),-2*this.DEFAULT_CHART_MARGIN,this.xScale,this.yScale)),this.svg.append("line").classed("personal-best-box-bottom",!0).attr("x1",-this.DEFAULT_CHART_MARGIN).attr("x2",-this.DEFAULT_CHART_MARGIN+this.xScale(1)).attr("y1",this.height).attr("y2",this.height),this.lineLayer=this.svg.append("g"),this.svg.append("circle").classed("personal-best-mark",!0).attr("cx",-this.DEFAULT_CHART_MARGIN).attr("cy",this.yScale(-t.duration())).attr("r",8).on("click",this.selectEffort(-1)),this.svg.append("circle").classed("personal-best-mark-inner",!0).attr("cx",-this.DEFAULT_CHART_MARGIN).attr("cy",this.yScale(-t.duration())).attr("r",5).on("click",this.selectEffort(-1))},r.prototype.drawPersonalBestMark=function(t,e){return null!==t?(this.svg.append("circle").classed("personal-best-mark",!0).attr("cx",this.xScale(e)).attr("cy",this.yScale(-t.duration())).attr("r",8).on("click",this.selectEffort(e)),this.svg.append("circle").classed("personal-best-mark-inner",!0).attr("cx",this.xScale(e)).attr("cy",this.yScale(-t.duration())).attr("r",5).on("click",this.selectEffort(e))):void 0},r.prototype.drawYears=function(t,e){var r,i,o,s,a,n,h,l,c,p,f,d;for(d=Strava.Segments.History.EffortYearGroups.build(this.historyWindow),o=0,p=0,t||(d.at(0).year()===e?(o=-1,p=1):this.drawPrBoxYear(e,this.xScale)),a=Number.POSITIVE_INFINITY,s=0,n=d.models,l=[],r=0,i=n.length;i>r;r++)f=n[r],c=p+f.length,h=this.drawYearLine(f.year(),o,c,s,a),s=h[0],a=h[1],o+=c,l.push(p=0);return l},r.prototype.drawYearLine=function(t,e,r,i,o){var s,a;return a=r,s=0,0===i&&(1===o||2===o)&&(1===r||2===r)&&(s=1),1===r?(this.svg.append("line").classed("axis",!0).attr({x1:this.xScale(e),x2:this.xScale(e),y1:this.height+25,y2:this.height+34+12*s}),e-=.8,r=1.6,this.svg.append("text").text(t).classed("year-label",!0).attr({"text-anchor":"middle",x:this.xScale(e+r/2),y:this.height+50+14*s}),[s,a]):(r-=1,this.svg.append("line").classed("axis",!0).attr({x1:this.xScale(e),x2:this.xScale(e),y1:this.height+27,y2:this.height+34}),this.svg.append("line").classed("axis",!0).attr({x1:this.xScale(e),x2:this.xScale(e+r),y1:this.height+30,y2:this.height+30}),this.svg.append("text").text(t).classed("year-label",!0).attr({"text-anchor":"middle",x:this.xScale(e+r/2),y:this.height+50+14*s}),this.svg.append("line").classed("axis",!0).attr({x1:this.xScale(e+r),x2:this.xScale(e+r),y1:this.height+27,y2:this.height+34}),[s,a])},r.prototype.drawPrBoxYear=function(t,e){return this.svg.append("line").classed("axis",!0).attr({x1:e(-2)-2,x2:e(-2)-2,y1:this.height+27,y2:this.height+34}),this.svg.append("line").classed("axis",!0).attr({x1:e(-2)-2,x2:e(-1)-2,y1:this.height+30,y2:this.height+30}),this.svg.append("line").classed("axis",!0).attr({x1:e(-1)-2,x2:e(-1)-2,y1:this.height+27,y2:this.height+34}),this.svg.append("line").classed("personal-best-box-bottom",!0).attr({x1:e(-1)-2,x2:e(0),y1:this.height+30,y2:this.height+30}),this.svg.append("text").text(t).classed("year-label",!0).attr({x:e(-2)-2,y:this.height+50})},r.prototype.completeXAxis=function(){return this.svg.append("line").classed("axis",!0).attr({x1:-this.chartMargin+1,x2:-this.chartMargin+this.xScale(1)+1,y1:this.height,y2:this.height})},r.prototype.createEffortBox=function(){var t,e;return t=this.svg.append("g"),t.append("text").attr({id:"effort-box-activity-date",x:5,y:i.MARGIN_TOP-5}),t.append("rect").attr({id:"effort-box",y:i.MARGIN_TOP,width:i.WIDTH,height:i.HEIGHT}),t.append("image").attr({id:"effort-box-pr-image","xlink:href":this.prAssetPath,x:i.PADDING_LEFT,y:i.MARGIN_TOP+i.PADDING_LEFT,width:0}),e=t.append("g").attr("id","effort-box-text-group"),e.append("a").attr("id","effort-box-activity-link").append("text").attr({id:"effort-box-activity-name",width:i.WIDTH-i.PADDING_LEFT,x:i.PADDING_LEFT,y:i.PADDING_TOP+i.LINE_HEIGHT+i.MARGIN_TOP}),e.append("text").attr({id:"effort-box-effort-duration",x:i.PADDING_LEFT,y:i.PADDING_TOP+2*i.LINE_HEIGHT+i.MARGIN_TOP}),e.append("text").attr({id:"effort-box-effort-rank",x:i.PADDING_LEFT+50,y:i.PADDING_TOP+2*i.LINE_HEIGHT+i.MARGIN_TOP}),e.append("text").attr({id:"effort-box-effort-speed",x:i.WIDTH-i.PADDING_LEFT,y:i.PADDING_TOP+2*i.LINE_HEIGHT+i.MARGIN_TOP}),t},r}(Backbone.View)}.call(this),function(){Strava.module("Strava.Segments.History"),Strava.Segments.History.AthleteHistoryChartController=function(){function t(t,e){this.history=new Strava.Segments.History.AthleteSegmentHistory({id:t}),this.history.fetch({success:function(t){var r;return r=new Strava.Segments.History.AthleteSegmentHistoryChart({prAssetPath:e,model:t}),r.render()}})}return t}()}.call(this),function(){var t=function(t,r){function i(){this.constructor=t}for(var o in r)e.call(r,o)&&(t[o]=r[o]);return i.prototype=r.prototype,t.prototype=new i,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Segments.History"),Strava.Segments.History.EffortYearGroup=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.model=Strava.Segments.History.SegmentEffort,r.prototype.efforts=function(){return this.models},r.prototype.width=function(){return this.models.length},r.prototype.year=function(){return this.at(0).startDate().getFullYear()},r}(Backbone.Collection)}.call(this),function(){Strava.module("Strava.Segments.History"),Strava.Segments.History.EffortYearGroups=function(){function t(t){this.models=t}return t.prototype.years=function(){return this.models},t.prototype.at=function(t){return this.models[t]},t.build=function(t){var e,r,i,o,s,a,n,h;if(0===t.width())return new Strava.Segments.History.EffortYearGroups([]);for(o=[],e=t.first().startDate().getFullYear(),h=[],n=t.efforts(),s=0,a=n.length;a>s;s++)r=n[s],r.startDate().getFullYear()===e?h[h.length]=r:(i=new Strava.Segments.History.EffortYearGroup(h),o.push(i),h=[r],e=r.startDate().getFullYear());return 0!==h.length&&(i=new Strava.Segments.History.EffortYearGroup(h),o.push(i)),new Strava.Segments.History.EffortYearGroups(o)},t}()}.call(this);